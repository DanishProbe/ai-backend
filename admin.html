<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <title>Admin – Analysefunktion</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    .container { max-width: 800px; margin: auto; }
    .input-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    input[type="text"], input[type="file"] { width: 100%; padding: 10px; }
    .button { padding: 10px 20px; background-color: #28a745; color: white; border: none; cursor: pointer; }
    .button:hover { background-color: #1e7e34; }
    .list { background: #f1f1f1; padding: 15px; border: 1px solid #ccc; margin-top: 20px; }
    ul { list-style-type: none; padding-left: 0; }
    li { text-align: left; margin-bottom: 10px; }
    .delete { color: red; cursor: pointer; margin-left: 10px; }
    #analysisResult { white-space: pre-wrap; background: #f8f8f8; padding: 15px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Admin Interface – Tilføj Regler, Lovgivning og Analysér PDF</h2>
    <div class="input-group">
      <label for="ruleInput">Tilføj Regel:</label>
      <input type="text" id="ruleInput">
      <button class="button" onclick="addItem('rules', 'ruleInput')">Gem Regel</button>
    </div>
    <div class="input-group">
      <label for="lawInput">Tilføj Lovgivning:</label>
      <input type="text" id="lawInput">
      <button class="button" onclick="addItem('laws', 'lawInput')">Gem Lov</button>
    </div>
    <div class="input-group">
      <label for="pdfUpload">Upload PDF til Analyse:</label>
      <input type="file" id="pdfUpload" accept="application/pdf">
      <button class="button" onclick="uploadAndAnalyze()">Analyser PDF</button>
    </div>
    <div class="list">
      <h3>Eksisterende Regler</h3>
      <ul id="rules"></ul>
    </div>
    <div class="list">
      <h3>Lovgivninger i brug</h3>
      <ul id="laws"></ul>
    </div>
    <div class="list">
      <h3>Resultat af Analyse</h3>
      <div id="analysisResult"></div>
    </div>
  </div>
  <script>
    const apiBase = location.origin;

    async function loadList(type) {
      const res = await fetch(`${apiBase}/${type}`);
      const data = await res.json();
      const listEl = document.getElementById(type);
      listEl.innerHTML = '';
      data.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item.text || item.name;
        const del = document.createElement('span');
        del.textContent = '✕';
        del.className = 'delete';
        del.onclick = () => deleteItem(type, item.id);
        li.appendChild(del);
        listEl.appendChild(li);
      });
    }

    async function addItem(type, inputId) {
      const input = document.getElementById(inputId);
      const value = input.value.trim();
      if (!value) return;
      await fetch(`${apiBase}/${type}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: value, name: value })
      });
      input.value = '';
      loadList(type);
    }

    async function deleteItem(type, id) {
      await fetch(`${apiBase}/${type}`, {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id })
      });
      loadList(type);
    }

    async function uploadAndAnalyze() {
      const fileInput = document.getElementById('pdfUpload');
      const file = fileInput.files[0];
      if (!file) {
        alert("Vælg en PDF-fil først.");
        return;
      }
      const formData = new FormData();
      formData.append("file", file);
      const res = await fetch(`${apiBase}/analyze`, {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      const resultDiv = document.getElementById('analysisResult');
      resultDiv.textContent = data.result || `Fejl ved analyse: ${data.error || 'Ukendt fejl'}`;
    }

    ['rules', 'laws'].forEach(loadList);
  </script>
</body>
</html>